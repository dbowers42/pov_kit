#!/usr/bin/env ruby
require 'gli'
begin # XXX: Remove this begin/rescue before distributing your app
  require 'pov_kit'

rescue LoadError
  STDERR.puts 'In development, you need to use `bundle exec bin/pov_kit` to run your app'
  STDERR.puts 'At install-time, RubyGems will make sure lib, etc. are in the load path'
  STDERR.puts 'Feel free to remove this message from bin/pov_kit now'
  exit 64
end

include GLI::App

program_desc 'Describe your application here'

version PovKit::VERSION

subcommand_option_handling :normal
arguments :strict

desc 'Describe some switch here'
switch [:a, :append]


desc 'File to output generated code to'
default_value 'untitled.inc'
arg_name 'output file'
flag [:f, :file]

flag [:l, :local]

flag [:g, :global]

desc 'Describe generate here'
arg_name 'Describe arguments to generate here'
command :generate do |c|
  c.desc 'Declare generated asset in local scope'
  c.switch :l, :local

  c.desc 'Declare generated asset in global scope'
  c.switch :g, :global

  c.action do |global_options, options, args|
    config = {
        flags: global_options,
        switches: options,
        args: args
    }

    puts PovKit::Generators::GeneratorFactory.build(args.first, config).render
  end
end

desc 'Describe new here'
arg_name 'Describe arguments to generate here'
command :init do |c|
  c.desc 'Creates a new POV-Ray project'
  c.action do |_global_options, _options, _args|

  end
end

pre do |_global, _command, _options, _args|
  # Pre logic here
  # Return true to proceed; false to abort and not call the
  # chosen command
  # Use skips_pre before a command to skip this block
  # on that command only
  true
end

post do |_global, _command, _options, _args|
  # Post logic here
  # Use skips_post before a command to skip this
  # block on that command only
end

on_error do |_exception|
  # Error logic here
  # return false to skip default error handling
  true
end

exit run(ARGV)

